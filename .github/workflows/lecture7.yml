name: Lecture7

on: push

jobs:
  sample-session:
    name: OTP ${{ matrix.otp_version }} / ${{ matrix.os }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        otp_version: [19, 23]
        os: [ubuntu-latest]

    container:
      image: erlang:${{ matrix.otp_version }}

    steps:
    - uses: actions/checkout@v2
    - name: Download Recent Rebar
      run: wget https://s3.amazonaws.com/rebar3/rebar3 && chmod 755 ./rebar3
    - name: Update Path
      run: echo "./" >> $GITHUB_PATH
    - name: Check rebar3 Version
      run: DEBUG=1 rebar3 --version
    - name: Build
      run: rebar3 release
    - name: Run app
      run: _build/default/rel/cache/bin/cache daemon
    - name: Demo
      run: ./demo.sh
    - name: Stop app
      run: _build/default/rel/cache/bin/cache stop
